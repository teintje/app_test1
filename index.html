<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Sensor Test</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #f0f0f0; padding-top: 50px; }
        .card { background: white; margin: 20px auto; padding: 20px; width: 80%; border-radius: 10px; shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .value { font-size: 24px; font-weight: bold; color: #007bff; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>Sensor Dashboard</h1>
    
    <div class="card">
        <p>Accelerometer (X-axis)</p>
        <div id="accelX" class="value">0.00</div>
    </div>
    <div class="card">
        <p>Velocity X</p>
        <div id="velX" class="value">0.0</div>
    </div>
        <div class="card">
        <p>Velocity Y </p>
        <div id="velY" class="value">0.0</div>
    </div>
        <div class="card">
        <p>Velocity Z </p>
        <div id="velZ" class="value">0.0</div>
    </div>



    <div class="card">
        <p>Gyroscope (Rotation Rate Z)</p>
        <div id="gyroZ" class="value">0.00</div>
    </div>

    <button id="start_btn">Enable Sensors</button>

    <script>
        const startBtn = document.getElementById('start_btn');
        
        
        startBtn.onclick = function() {
            // Check if the browser requires explicit permission (iOS and newer Android)
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            activateSensors();
                        }
                    })
                    .catch(console.error);
            } else {
                // For standard Android browsers
                activateSensors();
            }
            startBtn.style.display = 'none';
        };

        function activateSensors() {
            // Accelerometer
            window.addEventListener('devicemotion', (event) => {
                let x = event.accelerationIncludingGravity.x;

            });


            // Gyroscope
            window.addEventListener('deviceorientation', (event) => {
                let z = event.alpha; // alpha is rotation around the Z axis
                document.getElementById('gyroZ').innerText = z.toFixed(2);
            });
        }
        // These act like your Python global variables
        let velocityX = 0;
        let velocityY = 0;
        let velocityZ = 0;
        let velocity = 0;
        let positionX = 0;
        let lastTimestamp = 0;
        let roll = 0;
        let pitch = 0;
        let heading = 0;
    
        const velDisplay = document.getElementById('velX'); // Make sure you add this ID to your HTML!
        window.addEventListener('deviceorientation', (event) => {
            heading = event.alpha*Math.PI/180;
            pitch = event.beta*Math.PI/180;
            roll = event.gamma*Math.PI/180;
        });

            
        window.addEventListener('devicemotion', (event) => {
            // 1. Get acceleration (subtracting gravity is better for movement)
            let accX = event.acceleration.x; 
            let accY = event.acceleration.y;
            let accZ = event.acceleration.z;
            // Pre-calculate sines and cosines
            let c1 = Math.cos(heading), s1 = Math.sin(heading);
            let c2 = Math.cos(pitch), s2 = Math.sin(pitch);
            let c3 = Math.cos(roll), s3 = Math.sin(roll);
            
            // Body frame accelerations from your sensor
            let bx = event.acceleration.x;
            let by = event.acceleration.y;
            let bz = event.acceleration.z;
            
            // Matrix Multiplication (Body to Earth Frame)
            // This is the standard Euler rotation result:
            let earthX = (c1*c2)*bx + (c1*s2*s3 - s1*c3)*by + (c1*s2*c3 + s1*s3)*bz;
            let earthY = (s1*c2)*bx + (s1*s2*s3 + c1*c3)*by + (s1*s2*c3 - c1*s3)*bz;
            let earthZ = (-s2)*bx    + (c2*s3)*by          + (c2*c3)*bz;

// Now earthX is "East-ish", earthY is "North-ish", and earthZ is "Vertical"

            // 2. Get the time interval in seconds (event.interval is in ms)
            let dt = event.interval / 1000;
    
            if (earthX !== null && dt > 0) {
                // 3. Simple Integration (Velocity = acceleration * time)
                velocityX += earthX * dt;
                velocityY += earthY * dt;
                velocityZ += earthZ * dt;
                velocity = (velocityX**2 + velocityY**2 +velocityZ**2)**0.5 *3.6
    
                // 4. Update the screen
                document.getElementById('accelX').innerText = earthX.toFixed(2);
                document.getElementById('velX').innerText = velocityX.toFixed(1);
                document.getElementById('velY').innerText = velocityY.toFixed(1);
                document.getElementById('velZ').innerText = velocityZ.toFixed(1);
            }
        });


    
    </script>
</body>

</html>

















